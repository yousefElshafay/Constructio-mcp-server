# API Gateway Configuration for Constructio Generators API (OpenAPI 2.0)

swagger: "2.0"
info:
  title: Constructio Generators API (API Gateway)
  version: "1.0.0"
  description: |
    Production API Gateway configuration for Constructio Generators API.
    Provides API key authentication for service-to-service calls.

basePath: /

schemes:
  - https
consumes:
  - application/json
produces:
  - application/json

securityDefinitions:
  api_key:
    type: apiKey
    name: x-api-key
    in: header

security:
  - api_key: []

paths:
  /v1/generators:
    get:
      summary: List/search generators
      operationId: listGenerators
      x-google-backend:
        address: https://constructio-mcp-server-730645895766.europe-west1.run.app/v1/generators
        jwt_audience: https://constructio-mcp-server-730645895766.europe-west1.run.app
      parameters:
        - name: language
          in: query
          type: string
        - name: version
          in: query
          type: string
        - name: stack
          in: query
          type: string
        - name: tag
          in: query
          type: string
      responses:
        "200":
          description: List of generators

    post:
      summary: Create generator and get upload URL
      operationId: createGenerator
      x-google-backend:
        address: https://constructio-mcp-server-730645895766.europe-west1.run.app/v1/generators
        jwt_audience: https://constructio-mcp-server-730645895766.europe-west1.run.app
      parameters:
        - in: body
          name: body
          required: true
          schema:
            type: object
      responses:
        "201":
          description: Generator created

  /v1/generators/upload-url:
    post:
      summary: Get signed upload URL
      operationId: getUploadUrl
      x-google-backend:
        address: https://constructio-mcp-server-730645895766.europe-west1.run.app/v1/generators/upload-url
        jwt_audience: https://constructio-mcp-server-730645895766.europe-west1.run.app
      parameters:
        - in: body
          name: body
          required: true
          schema:
            type: object
      responses:
        "200":
          description: Signed upload URL

  /v1/generators/{generatorId}:
    get:
      summary: Get generator by ID
      operationId: getGenerator
      x-google-backend:
        address: https://constructio-mcp-server-730645895766.europe-west1.run.app/v1/generators/{generatorId}
        jwt_audience: https://constructio-mcp-server-730645895766.europe-west1.run.app
      parameters:
        - name: generatorId
          in: path
          required: true
          type: string
      responses:
        "200":
          description: Generator found

    delete:
      summary: Delete generator
      operationId: deleteGenerator
      x-google-backend:
        address: https://constructio-mcp-server-730645895766.europe-west1.run.app/v1/generators/{generatorId}
        jwt_audience: https://constructio-mcp-server-730645895766.europe-west1.run.app
      parameters:
        - name: generatorId
          in: path
          required: true
          type: string
      responses:
        "204":
          description: Generator deleted

  /v1/mcp:
    post:
      summary: MCP JSON-RPC endpoint
      operationId: mcpTools
      x-google-backend:
        address: https://constructio-mcp-server-730645895766.europe-west1.run.app/mcp/
        path_translation: CONSTANT_ADDRESS
        jwt_audience: https://constructio-mcp-server-730645895766.europe-west1.run.app
      parameters:
        - in: body
          name: body
          required: true
          schema:
            type: object
      responses:
        "200":
          description: MCP response
